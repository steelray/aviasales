<ng-container *ngIf="searchResult$ | async as searchResult;else spinner">
    <header>
        <div>
            <h1>
                Ташкент
                <mat-icon>swap_horiz</mat-icon>
                Бангкок
            </h1>
            <div class="back-again">Туда и обратно</div>
        </div>
        <button class="filter-btn" mat-icon-button (click)="onFilterToggle()">
            <mat-icon>filter_alt</mat-icon>
        </button>
    </header>


    <ng-container *ngIf="flights;else noRacesFound">
        <div
            class="search-results"
            infiniteScroll
            [infiniteScrollDistance]="2"
            [infiniteScrollThrottle]="50"
            (scrolled)="onScrollDown()">
            
            <mat-card class="race-item" *ngFor="let flight of flights;trackBy: trackByFn">
                <div class="race-item__header">
                    <div class="race-price">
                        {{flight.price | number | customNumber}}
                        <span>сум</span>
                    </div>
                    <div class="race-logos">
                        <img *ngFor="let carrier of flight.carriers" [src]="carrier | getAirlineLogo" alt="logo-1">
                    </div>
                </div>
                <mat-card-content>
                    <mat-list>
                        <mat-list-item>
                            <ng-container
                                [ngTemplateOutlet]="segment"
                                [ngTemplateOutletContext]="{segment: flight.segment.to}"></ng-container>
                        </mat-list-item>
                        <mat-list-item *ngIf="flight.segment.back">
                            <ng-container
                                [ngTemplateOutlet]="segment"
                                [ngTemplateOutletContext]="{segment: flight.segment.back}"></ng-container>
                        </mat-list-item>
    
                        <ng-template #race let-race>
    
                        </ng-template>
                    </mat-list>
                </mat-card-content>
                <mat-card-actions>
                    <button class="buy-btn" mat-raised-button color="primary">Купить</button>
                    <a [routerLink]="['/races', 1]" class="more-btn">
                        Подробнее
                        <mat-icon>keyboard_arrow_right</mat-icon>
                    </a>
                </mat-card-actions>
            </mat-card>
        </div>
       
    </ng-container>
    <ng-template #noRacesFound>
        По вашему запросу ничего не найдено. Попробуйте вернуться <a routerLink="/">на страницу поиска</a> и изменить параметры запроса.
    </ng-template>

    <app-races-filter 
        [class.active]="filterIsActive"
        (closed)="onFilterToggle()"></app-races-filter>
<div class="filter-backdrop" (click)="onFilterToggle()" [class.active]="filterIsActive"></div>

</ng-container>

<ng-template #spinner>
    <mat-spinner></mat-spinner>
</ng-template>

<ng-template let-segment="segment" #segment>
    <div class="race-item__col">
        <span>{{segment.departure}} - {{segment.arrival}}</span>
        <div>{{segment.departure_timestamp * 1000 | date:'HH:mm'}} - {{segment.arrival_timestamp * 1000 | date:'HH:mm'}}</div>
    </div>
    <div class="race-item__col text-center">
        <span>В пути</span>
        <div>{{segment.total_duration | minutesToHoursMins}}</div>
    </div>
    <div  class="race-item__col">
        <ng-container *ngIf="segment.transfers_total_duration">
            <span>{{segment.races.length | transferCount}}</span>
            <div>{{segment.transfers_total_duration / 60 | minutesToHoursMins}}</div>
        </ng-container>
    </div>
</ng-template>